<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AusSuper International Shares (Flexible Search)</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 40px; 
    max-width: 700px; 
    margin: auto; 
    background: #f5f5f5; 
    text-align: center; 
  }
  #output { 
    font-size: 3.5em; 
    margin: 30px 0; 
    padding: 40px; 
    background: white; 
    border-radius: 20px; 
    box-shadow: 0 6px 30px rgba(0,0,0,0.15); 
    font-weight: bold;
  }
  button { 
    padding: 15px 35px; 
    font-size: 1.3em; 
    background: #0078d4; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    cursor: pointer; 
    margin: 10px; 
  }
  button:hover { background: #106ebe; }
  .status { font-size: 1.2em; color: #666; margin: 15px 0; }
  #debug { 
    font-size: 0.85em; 
    color: #333; 
    background: #f8f8f8; 
    padding: 15px; 
    border-radius: 8px; 
    margin: 10px 0;
    max-height: 200px;
    overflow-y: auto;
    font-family: monospace;
    text-align: left;
  }
</style>
</head>
<body>

<h1>ü§ë AusSuper International Shares</h1>
<div class="status" id="status">Using working proxy...</div>
<div id="output">‚è≥</div>
<div id="debug"></div>
<button id="refreshBtn">üîÑ Refresh</button>

<script>
const TARGET_URL = 'https://www.australiansuper.com/why-choose-us/our-performance?superType=Super&display=table';

// Proxy 4 worked - using it exclusively
const WORKING_PROXY = 'https://api.codetabs.com/v1/proxy?quest=';

async function scrapeData() {
  const status = document.getElementById('status');
  const output = document.getElementById('output');
  const debug = document.getElementById('debug');
  
  status.textContent = '‚è≥ Fetching with working proxy...';
  output.textContent = '‚è≥';
  debug.innerHTML = '';
  
  try {
    const response = await fetch(WORKING_PROXY + encodeURIComponent(TARGET_URL));
    const html = await response.text();
    debug.innerHTML += `<strong>‚úÖ Proxy fetched ${html.length} chars</strong><br>`;
    
    // FLEXIBLE SEARCH - multiple possible markers
    const markers = [
      'diy-mixed-investment-choice">International Shares',
      'International Shares</a></th>',
      '"International Shares"',
      'International Shares',
      /International\s+Shares/i  // regex fallback
    ];
    
    let rowStart = -1, rowEnd = -1;
    let foundMarker = '';
    
    for (const marker of markers) {
      let index;
      if (typeof marker === 'string') {
        index = html.indexOf(marker);
      } else {
        const match = html.match(marker);
        index = match ? match.index : -1;
      }
      
      if (index !== -1) {
        foundMarker = marker;
        rowStart = html.lastIndexOf('<tr', index);
        rowEnd = html.indexOf('</tr>', index);
        debug.innerHTML += `<strong>‚úÖ Found "${foundMarker}" at ${index}</strong><br>`;
        break;
      }
    }
    
    if (rowStart === -1 || rowEnd === -1) {
      debug.innerHTML += `<strong>‚ùå No TR found, searching ALL % values...</strong><br>`;
      
      // FALLBACK: Find ANY row with percentages and "International"
      const percentMatches = html.match(/-?\d+\.?\d*%+/g) || [];
      const intlContext = html.match(/International[^<]*Shares[^<]*<\/th>/i);
      
      debug.innerHTML += `Total % values on page: ${percentMatches.length}<br>`;
      debug.innerHTML += `International context: ${intlContext ? intlContext[0].substring(0, 100) : 'none'}<br>`;
      
      // Look for cluster of 7+ percentages (table row pattern)
      const percentClusters = [];
      let currentCluster = [];
      
      for (let i = 0; i < percentMatches.length; i++) {
        currentCluster.push(percentMatches[i]);
        if (currentCluster.length >= 6 || i === percentMatches.length - 1) {
          percentClusters.push([...currentCluster]);
          currentCluster = [];
        }
      }
      
      if (percentClusters.length > 0) {
        // Use the largest cluster (likely our table row)
        const targetCluster = percentClusters.sort((a,b) => b.length - a.length)[0];
        debug.innerHTML += `<strong>Using cluster (${targetCluster.length} values):</strong><br>${targetCluster.join(', ')}<br>`;
        
        // Last non-zero
        for (let i = targetCluster.length - 1; i >= 0; i--) {
          const val = parseFloat(targetCluster[i].replace('%', ''));
          if (!isNaN(val) && Math.abs(val) > 0.0001) {
            const displayPct = val.toFixed(4);
            output.textContent = `${displayPct}%`;
            output.style.color = val >= 0 ? '#00aa44' : '#cc0000';
            status.textContent = `‚úÖ Found ${displayPct}%`;
            debug.innerHTML += `<strong>‚úÖ LAST NON-ZERO: ${displayPct}%</strong>`;
            return;
          }
        }
      }
      
      throw new Error('No valid data cluster found');
    }
    
    // Extract row and percentages
    const rowHtml = html.substring(rowStart, rowEnd + 5);
    const percents = rowHtml.match(/-?\d+\.?\d*%+/g) || [];
    debug.innerHTML += `<strong>Row percents (${percents.length}):</strong><br>${percents.join(', ')}<br>`;
    
    // Last non-zero
    let lastNonZero = null;
    for (let i = percents.length - 1; i >= 0; i--) {
      const val = parseFloat(percents[i].replace('%', ''));
      if (!isNaN(val) && Math.abs(val) > 0.0001) {
        lastNonZero = val;
        break;
      }
    }
    
    if (lastNonZero === null) {
      output.textContent = 'Currently no change.';
      output.style.color = '#666';
    } else {
      output.textContent = lastNonZero.toFixed(4) + '%';
      output.style.color = lastNonZero >= 0 ? '#00aa44' : '#cc0000';
    }
    
    status.textContent = '‚úÖ Live data loaded!';
    
  } catch (error) {
    status.textContent = `‚ùå ${error.message}`;
    output.textContent = 'Failed';
    output.style.color = '#cc0000';
    debug.innerHTML += `<strong>ERROR: ${error.message}</strong>`;
  }
}

// Auto-run
scrapeData();
document.getElementById('refreshBtn').addEventListener('click', scrapeData);
</script>

</body>
</html>

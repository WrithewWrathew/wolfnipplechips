<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AusSuper Auto-Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; max-width: 600px; margin: auto; background: #f5f5f5; text-align: center; }
  #output { font-size: 3em; margin: 30px 0; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
  button { padding: 15px 30px; font-size: 1.2em; background: #0078d4; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px; }
  button:hover { background: #106ebe; }
  .status { font-size: 1.1em; color: #666; margin: 10px 0; }
  .last-updated { font-size: 0.9em; color: #888; margin-top: 10px; }
</style>
</head>
<body>

<h1>ðŸ¤‘ AusSuper International Shares</h1>
<div class="status" id="status">Loading latest data...</div>
<div id="output">-</div>
<div class="last-updated" id="timestamp"></div>
<button id="refreshBtn">ðŸ”„ Refresh Now</button>

<script>
const API_URL = "https://www.australiansuper.com//api/graphs/dailyrates/download/?start=01/02/2026&end=08/02/2026&cumulative=False&superType=super&truncateDecimalPlaces=True&outputFilename=temp.csv";

function updateDisplay(intlSharesValue) {
  const output = document.getElementById("output");
  const status = document.getElementById("status");
  const timestamp = document.getElementById("timestamp");
  
  timestamp.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
  
  if (intlSharesValue === null || intlSharesValue === 0) {
    output.textContent = "Currently no change.";
    output.style.color = '#666';
    status.textContent = "Latest data shows no movement";
    return;
  }
  
  const pct = intlSharesValue.toFixed(2);
  output.textContent = `${pct}%`;
  output.style.color = intlSharesValue >= 0 ? '#00aa00' : '#cc0000';
  status.textContent = intlSharesValue >= 0 ? "â†‘ International Shares up" : "â†“ International Shares down";
}

function findLatestIntlShares(data) {
  // Find "International Shares" column
  const headers = data[0];
  const intlIndex = headers.findIndex(h => h.trim() === "International Shares");
  
  if (intlIndex === -1) {
    console.error("International Shares column not found");
    return null;
  }
  
  // Find last row with non-zero data
  for (let i = data.length - 1; i > 0; i--) {
    const row = data[i];
    if (!row || row.length <= intlIndex) continue;
    
    const intlValue = parseFloat(row[intlIndex]);
    const hasRealData = row.slice(1).some(val => {
      const num = parseFloat(val);
      return !isNaN(num) && num !== 0;
    });
    
    if (hasRealData) {
      return intlValue;
    }
  }
  
  return null;
}

function fetchData() {
  const status = document.getElementById("status");
  status.textContent = "Fetching data...";
  
  Papa.parse(API_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      console.log("CSV parsed:", results);
      
      if (results.errors.length > 0) {
        status.textContent = "Parse error - check console";
        console.error("PapaParse errors:", results.errors);
        return;
      }
      
      const intlValue = findLatestIntlShares(results.data);
      updateDisplay(intlValue);
    },
    error: function(err) {
      console.error("Fetch failed:", err);
      document.getElementById("status").textContent = "Failed to fetch data (CORS/proxy issue)";
    }
  });
}

// Auto-run on page load
fetchData();

// Manual refresh button
document.getElementById("refreshBtn").addEventListener("click", fetchData);
</script>

</body>
</html>
